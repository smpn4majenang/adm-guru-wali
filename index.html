<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Administrasi Guru Wali Digital</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: {
                        navy: { 900: '#1e293b', 800: '#334155', DEFAULT: '#1a2233' },
                        brand: { blue: '#4f46e5', light: '#f1f5f9' }
                    }
                }
            }
        }
    </script>

    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .nav-item-active { background-color: #2563eb !important; color: white !important; border-radius: 8px; }
        .form-input-custom { border: 1px solid #e2e8f0; border-radius: 8px; padding: 0.75rem 1rem; transition: all 0.2s; width: 100%; background-color: #fff; }
        .form-input-custom:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .action-btn { width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.15); color: white; }
        .action-btn:hover { transform: scale(1.1); }
        .section-header { font-size: 0.85rem; font-weight: 800; color: #1e293b; letter-spacing: 0.05em; margin: 2rem 0 1rem 0; border-bottom: 2px solid #f1f5f9; padding-bottom: 0.5rem; text-transform: uppercase; }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans h-screen flex overflow-hidden">

    <!-- LOGIN OVERLAY -->
    <div id="loginOverlay" class="fixed inset-0 bg-[#0f172a] z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 text-center">
            <h1 class="text-2xl font-bold text-slate-900 mb-2 uppercase tracking-tight">Portal Guru Wali</h1>
            <p class="text-slate-500 text-sm mb-6">Masukkan kode akses Anda.</p>
            <form onsubmit="app.login(event)">
                <input type="password" id="accessCode" class="w-full px-4 py-3 border rounded-xl text-center mb-4 outline-none focus:ring-2 focus:ring-brand-blue" placeholder="••••••" autofocus>
                <button type="submit" class="w-full bg-[#1e293b] text-white font-semibold py-3 rounded-xl hover:bg-slate-800 transition-all">Masuk</button>
            </form>
            <p id="loginError" class="text-red-500 text-xs mt-4 hidden">Kode akses salah.</p>
        </div>
    </div>

    <!-- MAIN APP CONTAINER -->
    <div id="appContainer" class="flex w-full h-full opacity-0 transition-opacity duration-500">
        <!-- Sidebar -->
        <aside id="sidebar" class="bg-[#1e293b] text-slate-300 w-64 flex-shrink-0 flex flex-col z-50 transform -translate-x-full md:translate-x-0 transition-transform duration-300">
            <div class="p-8 text-white font-bold text-lg leading-tight uppercase tracking-widest">ADMINISTRASI GURU WALI</div>
            <nav id="navLinks" class="flex-1 px-4 space-y-1 overflow-y-auto custom-scrollbar"></nav>
            <div class="p-6 border-t border-slate-700/50">
                <button onclick="app.logout()" class="flex items-center gap-2 text-xs text-slate-400 hover:text-white transition-colors uppercase tracking-widest font-semibold">
                    <i class="fas fa-sign-out-alt"></i> Keluar
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col min-w-0 bg-white md:bg-slate-50">
            <header class="md:hidden bg-white border-b p-4 flex justify-between items-center no-print">
                <span class="font-bold uppercase text-xs tracking-widest">Menu</span>
                <button onclick="app.toggleSidebar()" class="text-2xl"><i class="fas fa-bars"></i></button>
            </header>
            <div id="contentArea" class="flex-1 overflow-y-auto p-4 md:p-12 relative">
                <!-- Content will be injected here -->
            </div>
        </main>
    </div>

    <script>
        // MASUKKAN URL GOOGLE APPS SCRIPT ANDA DI SINI
        const API_URL = "https://script.google.com/macros/s/AKfycbyEF6TPuArduYhyxQB5_t2_RulNyuxVIvYjq3mVio4r9zURc49THfcE24FAWvv7wo5f/exec"; 

        const CONFIG = {
            SECRET_CODE: "guru123",
            MENUS: [
                { id: 'identitas', label: 'Isi Identitas', icon: 'fa-id-card' },
                { id: 'program', label: 'Program Kerja', icon: 'fa-tasks' },
                { id: 'jadwal', label: 'Jadwal Kegiatan', icon: 'fa-calendar-alt' },
                { id: 'data-murid', label: 'Data Murid', icon: 'fa-users' },
                { id: 'profil-murid', label: 'Profil Murid', icon: 'fa-user-graduate' },
                { id: 'jurnal', label: 'Jurnal Pertemuan', icon: 'fa-book' },
                { id: 'laporan', label: 'Laporan Perkembangan', icon: 'fa-chart-line' },
                { id: 'rencana', label: 'Rencana Pengembangan', icon: 'fa-lightbulb' }
            ]
        };

        let cachedMurid = [];

        const app = {
            activeMenuId: null,

            init: () => {
                if (sessionStorage.getItem('isLoggedIn')) app.showApp();
                app.renderSidebar();
            },

            login: (e) => {
                e.preventDefault();
                if (document.getElementById('accessCode').value === CONFIG.SECRET_CODE) {
                    sessionStorage.setItem('isLoggedIn', 'true');
                    app.showApp();
                } else {
                    document.getElementById('loginError').classList.remove('hidden');
                }
            },

            logout: () => { sessionStorage.removeItem('isLoggedIn'); window.location.reload(); },

            showApp: () => {
                document.getElementById('loginOverlay').classList.add('hidden');
                document.getElementById('appContainer').classList.remove('opacity-0');
                app.navigate('identitas');
            },

            toggleSidebar: () => document.getElementById('sidebar').classList.toggle('-translate-x-full'),

            renderSidebar: () => {
                const container = document.getElementById('navLinks');
                container.innerHTML = CONFIG.MENUS.map(m => `
                    <button onclick="app.navigate('${m.id}')" id="nav-${m.id}" 
                        class="w-full flex items-center gap-3 px-4 py-3 text-[13px] font-medium transition-all text-slate-400 hover:text-white group text-left">
                        <i class="fas ${m.icon} w-5"></i>
                        <span>${m.label}</span>
                    </button>
                `).join('');
            },

            navigate: (id) => {
                app.activeMenuId = id;
                document.querySelectorAll('#navLinks button').forEach(b => b.classList.remove('nav-item-active'));
                const navBtn = document.getElementById(`nav-${id}`);
                if(navBtn) navBtn.classList.add('nav-item-active');
                
                if (window.innerWidth < 768) document.getElementById('sidebar').classList.add('-translate-x-full');
                
                app.renderPage(id);
            },

            renderPage: (id) => {
                const container = document.getElementById('contentArea');
                let html = `<div class="max-w-5xl mx-auto bg-white p-6 md:p-14 rounded-3xl shadow-sm border border-slate-100 min-h-full relative">`;
                
                const menu = CONFIG.MENUS.find(m => m.id === id);
                html += `<div class="text-center mb-10"><h1 class="text-3xl font-bold text-slate-800 uppercase tracking-tight">${menu.label}</h1></div>`;
                html += `<form id="mainForm" onsubmit="app.handleSave(event)">`;

                // Logic Form Per Halaman
                if (id === 'laporan' || id === 'rencana' || id === 'jurnal' || id === 'profil-murid') {
                    html += `
                        <div class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-center">
                                <label class="md:col-span-3 text-sm font-semibold">Nama Murid</label>
                                <select name="nama_murid" id="muridSelector" class="md:col-span-9 form-input-custom" required>
                                    <option value="">Pilih Murid...</option>
                                </select>
                            </div>
                    `;
                }

                if (id === 'laporan') {
                    html += `
                        <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-center">
                            <label class="md:col-span-3 text-sm font-semibold">Periode</label>
                            <div class="md:col-span-9 flex gap-4">
                                <label class="flex items-center gap-2"><input type="radio" name="periode" value="Ganjil"> Ganjil</label>
                                <label class="flex items-center gap-2"><input type="radio" name="periode" value="Genap"> Genap</label>
                            </div>
                        </div>
                        <div class="section-header">A. Perkembangan Akademik</div>
                        <textarea name="akademik_pencapaian" class="form-input-custom mb-4" placeholder="Rangkuman Pencapaian..." rows="3"></textarea>
                        <div class="section-header">B. Karakter</div>
                        <textarea name="karakter_positif" class="form-input-custom" placeholder="Observasi Sikap Positif..." rows="3"></textarea>
                    `;
                } else if (id === 'rencana') {
                    html += `
                        <div class="section-header">Target Saya Semester Ini</div>
                        <div class="space-y-4">
                            <input type="text" name="target_akademik" class="form-input-custom" placeholder="Target Akademik">
                            <input type="text" name="target_karakter" class="form-input-custom" placeholder="Target Karakter">
                        </div>
                    `;
                } else if (id === 'data-murid') {
                    html += `
                        <div class="space-y-4">
                            <input type="text" name="nama_lengkap_murid" class="form-input-custom" placeholder="Nama Lengkap Murid" required>
                            <input type="text" name="nis_nisn" class="form-input-custom" placeholder="NIS / NISN">
                            <input type="text" name="kelas" class="form-input-custom" placeholder="Kelas">
                        </div>
                    `;
                } else {
                    html += `<p class="text-center text-slate-400 italic py-10">Form ${menu.label} siap diisi.</p>`;
                }

                html += `</div></form>`;
                html += app.renderFloatingActions();
                html += `</div>`;
                
                container.innerHTML = html;
                if (id === 'laporan' || id === 'rencana' || id === 'jurnal' || id === 'profil-murid') app.loadMuridDropdown();
            },

            loadMuridDropdown: async () => {
                if (!API_URL) return;
                const selector = document.getElementById('muridSelector');
                try {
                    const res = await fetch(`${API_URL}?menu=data-murid`);
                    const data = await res.json();
                    cachedMurid = data;
                    data.forEach(m => {
                        const opt = document.createElement('option');
                        opt.value = m.nama_lengkap_murid;
                        opt.textContent = m.nama_lengkap_murid;
                        selector.appendChild(opt);
                    });
                } catch (e) { console.error(e); }
            },

            renderFloatingActions: () => `
                <div class="fixed bottom-10 right-10 flex flex-col gap-4 no-print">
                    <button type="submit" form="mainForm" class="action-btn bg-purple-600" title="Simpan"><i class="fas fa-save"></i></button>
                    <button onclick="window.print()" class="action-btn bg-blue-500" title="Cetak"><i class="fas fa-print"></i></button>
                </div>
            `,

            handleSave: async (e) => {
                e.preventDefault();
                if (!API_URL) return alert("URL API belum diisi di kode!");
                
                const btn = e.submitter;
                const originalHtml = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                btn.disabled = true;

                const formData = new FormData(e.target);
                const payload = {};
                formData.forEach((v, k) => payload[k] = v);

                try {
                    await fetch(API_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify({
                            menu: app.activeMenuId,
                            payload: payload
                        })
                    });
                    alert("Data berhasil dikirim ke sistem!");
                    e.target.reset();
                } catch (err) {
                    alert("Terjadi kesalahan koneksi.");
                } finally {
                    btn.innerHTML = originalHtml;
                    btn.disabled = false;
                }
            }
        };

        window.onload = app.init;
    </script>
</body>
</html>
